<form action="/api/upload/zip" method="post" enctype="multipart/form-data">
    <input type="file" name="upload" /> {% csrf_token %}
    <input type="submit" value="Upload Zip" />
</form>
<br>
<form action="/api/source/source_filename" method="post" enctype="multipart/form-data">
    <input type="file" name="upload" /> {% csrf_token %}
    <input type="submit" value="Upload Source (.tr)" />
</form>

{% if lasttake %}
<a href="/api/languages">Languages</a> <br><br>
<a href="/api/books">Books</a> <br><br>
<a href="/api/takes">Takes</a> <br><br>
<a href="/api/users">Users</a> <br><br>
<a href="/api/comments">Comments</a> <br><br><br>
<a href="/api/get_project">Get Project</a> <br><br>
<a href="/api/update_project">Update Project</a> <br><br><br>
<a href="/api/zipFiles">Zip Files</a> <br><br><br>
<a href="/api/all_project">Show Project</a> <br><br>
<a href="/api/get_chapters">Show Chapters</a><br><br>
<a href="/api/get_versions">Show Versions</a><br><br>

<div>
    <div>{{ lasttake }}</div>
    <audio controls>
        <source src="/api/stream/{{ lasttake.location }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
</div>
<br>
<div>
    <button id="getexport">Get Zip For Export</button>
    <img style="display: none" id="getexport_loader" src="/static/loader.gif" />
</div>
<br>
<div>
    <button id="getsource">Get Source (.tr)</button>
    <img style="display: none" id="getsource_loader" src="/static/loader.gif" />
</div>
<br>
<div>
    <button id="getzip">Get zip</button>
    <img style="display: none" id="getzip_loader" src="/static/loader.gif" />
</div>
{% endif %}

<script>
    document.getElementById("getexport").addEventListener("click", function(event) {
        document.getElementById("getexport_loader").style.display = "inline-block";
        jspost("/api/zipFiles/", {
            "language": "en-x-demo2",
            "version": "ulb",
            "book": "mrk"
        }, function(response) {
            document.getElementById("getexport_loader").style.display = "none";
            saveAs(response, 'en-x-demo2_ulb_mrk.zip')
        })
    }, false);

    document.getElementById("getsource").addEventListener("click", function(event) {
        document.getElementById("getsource_loader").style.display = "inline-block";
        jspost("/api/get_source/", {
            "language": "en-x-demo2",
            "version": "ulb",
            "is_source": false
        }, function(response) {
            document.getElementById("getsource_loader").style.display = "none";
            saveAs(response, 'en-x-demo2_ulb.tr')
        })
    }, false);

    document.getElementById("getzip").addEventListener("click", function(event) {
        loader = document.getElementById("getzip_loader");
        loader.style.display = "inline-block"
        jspost("/api/push_comments_takes/", {
            "project": {
                "language": "en-x-demo2",
                "version": "ulb",
                "book": "mrk"
            },
            "files_list": {}
        }, function(response) {
            loader.style.display = "none";
            console.log(loader.style.display);
            saveAs(response, 'en-x-demo2_ulb_mrk.zip')
        })
    }, false);

    function jspost(url, data, success) {
        var xmlhttp = new XMLHttpRequest(); // new HttpRequest instance 
        xmlhttp.open("POST", url);
        xmlhttp.responseType = "blob"

        xmlhttp.onreadystatechange = function() {
            if (this.readyState == XMLHttpRequest.DONE) {
                success(this.response);
            }
        }

        xmlhttp.setRequestHeader("Content-Type", "application/json");
        xmlhttp.send(JSON.stringify(data));
    }
</script>

<script src="/static/FileSaver.min.js"></script>